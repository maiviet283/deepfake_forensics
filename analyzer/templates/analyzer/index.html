{% extends "layout.html" %}
{% load static %} 

{% block head %}
    <title>Ph√¢n T√≠ch ·∫¢nh</title>
    <link rel="stylesheet" href='{% static "analyzer/css/index.css" %}' />
    <script src='{% static "analyzer/js/index.js" %}'></script>
{% endblock head %} 

{% block body %}
    <h1 id="title-h1">üß† Ph√¢n T√≠ch ·∫¢nh</h1>

    <div class="d-flex justify-content-center gap-3 flex-wrap mt-4">
        <a href="/" class="btn btn-outline-secondary btn-lg px-4 shadow">üè† Trang Ch·ªß</a>
        <a href="/admin" class="btn btn-outline-secondary btn-lg px-4 shadow">üõ†Ô∏è Qu·∫£n Tr·ªã</a>
        <a href="/analyzer/history" class="btn btn-outline-secondary btn-lg px-4 shadow">üìú L·ªãch S·ª≠</a>
    </div>

    <div class="container">
        
        <!-- Left Column: Upload Image -->
        <div class="upload-section">
            <h2>Ph√¢n T√≠ch ·∫¢nh</h2>
            <form action="" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <label for="image">Ch·ªçn ·∫£nh c·∫ßn ph√¢n t√≠ch</label>
                <input type="file" id="image" name="image" accept="image/*" required onchange="handleImageChange(event)" />
                <input type="hidden" name="image_metadata" id="image_metadata" />
                <input type="submit" value="Ph√¢n T√≠ch" />
            </form>

            {% if image_url %}
                <center><img id="preview" src="{{ image_url }}" /></center>
            {% else %}
                <center><img id="preview" /></center>
            {% endif %}

            <br><center><a href="/">Quay v·ªÅ Trang Ch·ªß</a> - <a href='{% url "analyzer:history" %}'>L·ªãch S·ª≠ Ph√¢n T√≠ch</a></center>
        </div>


        <!-- Middle Column: Metadata -->
        <div class="metadata-section">
            <h2>Metadata File</h2>
            {% if result_metadata %}
                <ul>
                    <li><strong>T√™n t·ªáp:</strong> {{ result_metadata.fileName }}</li>
                    <li><strong>K√≠ch th∆∞·ªõc (KB):</strong> {{ result_metadata.fileSizeKB }}</li>
                    <li><strong>Lo·∫°i MIME:</strong> {{ result_metadata.mimeType }}</li>
                    <li><strong>Ph·∫ßn m·ªü r·ªông:</strong> {{ result_metadata.fileExtension }}</li>
                    <li><strong>Ng√†y s·ª≠a cu·ªëi:</strong> {{ result_metadata.lastModified }}</li>
                    <li><strong>L√† ·∫£nh raster?:</strong> {{ result_metadata.isRaster|yesno:"C√≥,Kh√¥ng" }}</li>
                    <li><strong>C√≥ th·ªÉ preview?:</strong> {{ result_metadata.canPreview|yesno:"C√≥,Kh√¥ng" }}</li>
                    <li><strong>K√≠ch th∆∞·ªõc ·∫£nh:</strong> {{ result_metadata.width }} x {{ result_metadata.height }} px</li>
                    <li><strong>T·ª∑ l·ªá ·∫£nh:</strong> {{ result_metadata.aspectRatio }}</li>
                    <li><strong>Orientation:</strong> {{ result_metadata.orientation }}</li>
                    <li><strong>DPI ∆∞·ªõc l∆∞·ª£ng:</strong> {{ result_metadata.estimatedDpi }}</li>
                </ul>
            {% else %}
                <p>Ch∆∞a c√≥ metadata.</p>
            {% endif %}
        </div>


        <!-- Right Column: AI Analysis -->
        <div class="analysis-section">
            <h2>K·∫øt Qu·∫£</h2>
            {% if result_decopy %}
                <h3>Decopy AI</h3>
                <ul>
                    <li><img src="{% static 'analyzer/images/decopy_ai.png' %}" /></li>
                    <li><strong>K·∫øt lu·∫≠n:</strong> {{ result_decopy.isItAi }}</li>
                    <li><strong>ƒê·ªô Tin C·∫≠y :</strong> {{ result_decopy.probability }} %</li>
                </ul>
            {% endif %}
            

            {% if result_waist %}
                <h3>Wasit AI</h3>
                <ul>
                    <li><img src="{% static 'analyzer/images/wasit_ai.png' %}" /></li>
                    <li><strong>K·∫øt lu·∫≠n:</strong> {{ result_waist.isItAi }}</li>
                    <li><strong>ƒê·ªô Tin C·∫≠y :</strong> {{ result_waist.probability }} %</li>
                    <li><strong>M√¥ T·∫£:</strong> {{ result_waist.description }}</li>
                </ul>
            {% endif %}

            {% if result_final %}
                <h3>T·ªïng K·∫øt</h3>
                <ul>
                    <li><strong>K·∫øt lu·∫≠n:</strong> {{result_final.isItAi}} </li>
                    <li><strong>ƒê·ªô Tin C·∫≠y:</strong> {{result_final.probability}} %</li>
                </ul>
            {% endif %}
                
        </div>
{% endblock body %}
